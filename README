
Scripts used to simulate evolution of populations with varying levels of genetic diversity with and without epistasis.

The script `run_simulations.sh` will reproduce simulations used in Fig. 1bc, Table 1 and Supplementary Fig. 14-19.
For large population size and mutation rate, simulations can take some time. To produce a lot of simulations used in the paper, the calculations were parallelized.

#### Pairwise epistasis

We simulate pairwise compensatory epistasis using [FFPopSim](https://github.com/neherlab/ffpopsim) python package (Zanini and Neher, Bioinformatics 2012). 
We model two types of sites, depending on whether mutations in them are neutral (with selection coefficient s = 0) or weakly deleterious (s â‰¤ 0), 
representing synonymous and nonsynonymous sites correspondingly. There are twice as many nonsynonymous as synonymous sites. 
Under the non-epistatic model, selection coefficient of a nonsynonymous mutation is independent of the genetic background. 
Under pairwise epistasis, a mutation at one nonsynonymous site can be fully compensated by a mutation at another site.

The python script to perform such simulations is `sim_pairwise.py`.

```python
usage: sim_pairwise.py [-h] [-i I] [-N N] [-L L] [--mu MU]
                       [--epi_mode {isolated}] [--rec REC] [--gen GEN]
                       [--sigma SIGMA] [--sample SAMPLE] [--freq FREQ] [--p P]
                       [--mode {panmixic,admixture,balancing,sweep}]
                       [--outfmt {stats,alignment,fitness,distance,arg}]

optional arguments:
  -h, --help            show this help message and exit
  -i I                  number of simulations
  -N N                  population size
  -L L                  sequence length
  --mu MU               mutation rate(s)
  --epi_mode {isolated}
                        epstasis mode; only 'isolated' is implemented so far
  --rec REC             recombination rate(s) population scaled
  --gen GEN             generations to simulate, number of steps
  --sigma SIGMA         selection coefficient(s) of deleterious mutations
                        (population-scaled)
  --sample SAMPLE       sample size
  --freq FREQ           frequency threshold
  --p P                 scale coefficient of DFE
  --mode {panmixic,admixture,balancing,sweep}
                        population mode
  --outfmt {stats,alignment,fitness,distance,arg}
                        output

```


Detailed description:


If `I` (the number of simulations) is equal to 1, a pair of simulations will be produced: one without epistasis and one with epistasis under the same population parameters
and simulation mode (see below). `I` means the number of such pairs of simulations. All simulations are independent from each other and are defined only with 
parameters of the population and the simulation mode.

`N` indicates population size. Population size also defines the number of generations needed to be simulated to achieve mutation-selection equilibirum: we usually use 10N
generations.



The script can be easily adjusted for your purpose.

